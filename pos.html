<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hotel Booking</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body {
      background: linear-gradient(to right, #6a11cb, #2575fc);
      font-family: Arial, sans-serif;
      color: #000;
    }

    .navbar {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .table thead, .table td, .table th {
      color: #000 !important;
    }

    .modal-content {
      border-radius: 12px;
    }

    .modal-header, .modal-footer {
      background-color: #f8f9fa;
    }

    label, input, select, .modal-title, .modal-body, .modal-footer {
      color: #000 !important;
    }

    .notification {
      background-color: #198754;
      color: #fff;
      padding: 10px;
      border-radius: 5px;
      margin-top: 15px;
      display: none;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light px-3">
    <a class="navbar-brand text-white" href="#">Hotel Booking</a>
    <div class="ms-auto">
      <a href="pos.html" class="btn btn-warning btn-sm">POS</a>
      <a href="login.html" class="btn btn-danger btn-sm">Logout</a>
    </div>
  </nav>

  <div class="container mt-4">
    <label for="dateSelector" class="form-label text-white">Select Date</label>
    <input type="date" class="form-control mb-4" id="dateSelector" />

    <h3 class="text-white">Room Status</h3>
    <table class="table table-light table-bordered">
      <thead>
        <tr>
          <th>Room</th>
          <th>Status</th>
          <th>Guest</th>
          <th>Total (£)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="roomTable"></tbody>
    </table>

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bookingModal">New Booking</button>
    <div class="notification" id="notification">Booking Confirmed!</div>
  </div>

  <!-- Booking Modal -->
  <div class="modal fade" id="bookingModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="bookingForm">
          <div class="modal-header">
            <h5 class="modal-title">Create Booking</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <label class="form-label">Guest Name</label>
            <input type="text" class="form-control" id="guestName" required />
            <label class="form-label mt-2">Arrival</label>
            <input type="date" class="form-control" id="arrival" required />
            <label class="form-label mt-2">Departure</label>
            <input type="date" class="form-control" id="departure" required />
            <label class="form-label mt-2">Room</label>
            <select class="form-control" id="roomSelect" required></select>
            <button type="button" class="btn btn-warning btn-sm mt-2" id="findRoomBtn">Find Room</button>
            <div class="form-check mt-3">
              <input class="form-check-input" type="checkbox" id="addTab">
              <label class="form-check-label" for="addTab">Add £50 Deposit</label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-sm">Confirm</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Details Modal -->
  <div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Booking Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="detailsContent"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const dateSelector = document.getElementById("dateSelector");
    const roomTable = document.getElementById("roomTable");
    const roomSelect = document.getElementById("roomSelect");
    const notification = document.getElementById("notification");

    let bookings = JSON.parse(localStorage.getItem("bookings") || "[]");
    let rooms = JSON.parse(localStorage.getItem("rooms") || JSON.stringify({
      "101": false, "102": false, "103": false, "104": false
    }));

    function save() {
      localStorage.setItem("bookings", JSON.stringify(bookings));
      localStorage.setItem("rooms", JSON.stringify(rooms));
    }

    function renderRooms() {
      const selectedDate = dateSelector.value;
      roomTable.innerHTML = "";

      for (const [room, isClean] of Object.entries(rooms)) {
        const booking = bookings.find(b =>
          b.room === room &&
          selectedDate >= b.arrival &&
          selectedDate <= b.departure
        );

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${room}</td>
          <td>
            ${isClean ? '<span class="badge bg-success">Clean</span>' :
            `<button class="btn btn-sm btn-success" onclick="markClean('${room}')">Mark Clean</button>`}
          </td>
          <td>${booking ? booking.name : '-'}</td>
          <td>${booking && booking.tab ? 50 : 0}</td>
          <td>
            ${booking ? `<button class="btn btn-sm btn-info" onclick="viewDetails('${room}')">Details</button>` : '-'}
          </td>
        `;
        roomTable.appendChild(row);
      }

      populateRoomDropdown();
    }

    function populateRoomDropdown() {
      roomSelect.innerHTML = "";
      for (const room in rooms) {
        roomSelect.innerHTML += `<option value="${room}">Room ${room}</option>`;
      }
    }

    function markClean(room) {
      rooms[room] = true;
      save();
      renderRooms();
    }

    document.getElementById("bookingForm").addEventListener("submit", e => {
      e.preventDefault();

      const newBooking = {
        name: document.getElementById("guestName").value,
        arrival: document.getElementById("arrival").value,
        departure: document.getElementById("departure").value,
        room: roomSelect.value,
        tab: document.getElementById("addTab").checked
      };

      bookings.push(newBooking);
      save();
      renderRooms();
      document.getElementById("bookingForm").reset();
      const modal = bootstrap.Modal.getInstance(document.getElementById("bookingModal"));
      modal.hide();

      notification.style.display = "block";
      setTimeout(() => notification.style.display = "none", 2000);
    });

    document.getElementById("findRoomBtn").addEventListener("click", () => {
      const selectedDate = dateSelector.value;
      const available = Object.entries(rooms).find(([room]) => {
        return !bookings.some(b =>
          b.room === room &&
          selectedDate >= b.arrival &&
          selectedDate <= b.departure
        );
      });
      if (available) {
        roomSelect.value = available[0];
      } else {
        alert("No available rooms.");
      }
    });

    function viewDetails(room) {
      const selectedDate = dateSelector.value;
      const booking = bookings.find(b =>
        b.room === room &&
        selectedDate >= b.arrival &&
        selectedDate <= b.departure
      );
      if (!booking) return;
      document.getElementById("detailsContent").innerHTML = `
        <p><strong>Guest:</strong> ${booking.name}</p>
        <p><strong>Room:</strong> ${booking.room}</p>
        <p><strong>Arrival:</strong> ${booking.arrival}</p>
        <p><strong>Departure:</strong> ${booking.departure}</p>
        <p><strong>Total:</strong> £${booking.tab ? 50 : 0}</p>
      `;
      const modal = new bootstrap.Modal(document.getElementById("detailsModal"));
      modal.show();
    }

    dateSelector.addEventListener("change", renderRooms);
    dateSelector.valueAsDate = new Date();
    renderRooms();
  </script>
</body>
</html>
