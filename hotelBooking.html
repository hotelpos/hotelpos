<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hotel Booking System</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    .navbar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 20px; background-color: #222; color: white;
    }
    .navbar h1 { margin: 0; font-size: 20px; }
    .nav-links button, .dropdown-btn {
      background: #444; color: white; padding: 8px 12px; margin: 0 5px;
      border: none; border-radius: 4px; cursor: pointer;
    }
    .nav-links button:hover, .dropdown-content button:hover { background: #666; }
    .dropdown {
      position: relative; display: inline-block;
    }
    .dropdown-content {
      display: none; position: absolute; background-color: white;
      min-width: 160px; box-shadow: 0px 8px 16px rgba(0,0,0,0.2); z-index: 1;
    }
    .dropdown-content button {
      width: 100%; padding: 10px; text-align: left; border: none; background: white; color: black;
    }
    .dropdown:hover .dropdown-content { display: block; }

    .container { padding: 20px; }
    .room-card {
      background: white; padding: 10px; margin: 10px 0; border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;
    }
    .room-info span { display: block; }
    .button-green, .button-red, .button-blue {
      padding: 6px 12px; border: none; border-radius: 4px; color: white; cursor: pointer;
    }
    .button-green { background: green; }
    .button-red { background: red; }
    .button-blue { background: dodgerblue; }

    .modal {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center;
      z-index: 10;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 6px; width: 400px; position: relative;
    }
    .close { position: absolute; top: 10px; right: 10px; cursor: pointer; }

    .form-row { margin-bottom: 10px; }
    input[type="text"], input[type="date"], select {
      width: 100%; padding: 8px; margin-top: 4px; border-radius: 4px; border: 1px solid #ccc;
    }

    #daySelector { padding: 6px; margin-left: 10px; }

    .modal-popup {
      padding: 10px 0;
    }
  </style>
</head>
<body>

  <div class="navbar">
    <div>
      <button onclick="location.href='index.html'">Exit</button>
      <button onclick="location.href='pos.html'">POS</button>
      <button onclick="location.href='hotelBooking.html'">Hotel Booking</button>
      <select id="daySelector" onchange="renderBookings()"></select>
    </div>
    <div class="dropdown">
      <button class="dropdown-btn">Admin ⌄</button>
      <div class="dropdown-content">
        <button onclick="showPopup('history')">History</button>
        <button onclick="showPopup('upcoming')">Upcoming</button>
      </div>
    </div>
  </div>

  <div class="container">
    <button class="button-blue" onclick="showBookingForm()">+ New Booking</button>
    <div id="roomsContainer"></div>
  </div>

  <!-- Booking Modal -->
  <div class="modal" id="bookingModal">
    <div class="modal-content">
      <span class="close" onclick="closeBookingForm()">×</span>
      <h3>New Booking</h3>
      <div class="form-row">
        <label>Guest Name:</label>
        <input type="text" id="guestName" />
      </div>
      <div class="form-row" style="display: flex; gap: 10px;">
        <div style="flex: 1;">
          <label>Room:</label>
          <select id="roomNumber">
            <option>101</option><option>102</option><option>103</option>
            <option>104</option><option>105</option><option>106</option>
          </select>
        </div>
        <div style="flex: 1;">
          <label>&nbsp;</label>
          <button style="width: 100%;" onclick="findRoom()">Find Room</button>
        </div>
      </div>
      <div class="form-row">
        <label>Arrival Date:</label>
        <input type="date" id="arrivalDate" />
      </div>
      <div class="form-row">
        <label>Departure Date:</label>
        <input type="date" id="departureDate" />
      </div>
      <div class="form-row">
        <label><input type="checkbox" id="depositBox" /> Add £50 Tab Deposit</label>
      </div>
      <div style="text-align: right;">
        <button class="button-green" onclick="confirmBooking()">Confirm</button>
        <button onclick="closeBookingForm()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Generic Popup -->
  <div class="modal" id="popupModal">
    <div class="modal-content">
      <span class="close" onclick="document.getElementById('popupModal').style.display='none'">×</span>
      <div id="popupContent"></div>
    </div>
  </div>

<script>
let bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
const today = new Date();
let selectedDate = today.toISOString().split('T')[0];

function init() {
  generateDaySelector();
  renderBookings();
}
function generateDaySelector() {
  const sel = document.getElementById('daySelector');
  sel.innerHTML = '';
  for (let i = -2; i <= 7; i++) {
    const d = new Date();
    d.setDate(today.getDate() + i);
    const val = d.toISOString().split('T')[0];
    const opt = document.createElement('option');
    opt.value = val;
    opt.textContent = val;
    if (val === selectedDate) opt.selected = true;
    sel.appendChild(opt);
  }
  sel.onchange = () => {
    selectedDate = sel.value;
    renderBookings();
  };
}

function renderBookings() {
  const container = document.getElementById('roomsContainer');
  container.innerHTML = '';
  for (let room = 101; room <= 106; room++) {
    const booking = bookings.find(b => b.room == room && b.arrival === selectedDate);
    const div = document.createElement('div');
    div.className = 'room-card';
    div.innerHTML = `
      <div class="room-info">
        <span><strong>Room ${room}</strong></span>
        <span>Status: ${booking ? (booking.checkedIn ? 'Checked In' : 'Reserved') : 'Available'}</span>
        <span>Guest: ${booking?.guest || '-'}</span>
        <span>Bill: £${booking?.bill || 0}</span>
      </div>
      <div>
        ${booking ? (booking.checkedIn
          ? `<button class="button-blue" onclick="showAction(${room})">Action</button>`
          : `<button class="button-green" onclick="attemptCheckin(${room})">Check In</button>`)
          : `<span>-</span>`}
      </div>
    `;
    container.appendChild(div);
  }
}

function showBookingForm() {
  document.getElementById('bookingModal').style.display = 'flex';
}

function closeBookingForm() {
  document.getElementById('bookingModal').style.display = 'none';
}

function confirmBooking() {
  const guest = document.getElementById('guestName').value;
  const room = document.getElementById('roomNumber').value;
  const arrival = document.getElementById('arrivalDate').value;
  const departure = document.getElementById('departureDate').value;
  const deposit = document.getElementById('depositBox').checked ? 50 : 0;
  const bill = 75 + deposit;

  if (!guest || !arrival || !departure) return showPopupMessage("Please fill out all fields.");

  const overlap = bookings.some(b => b.room === room &&
    ((arrival >= b.arrival && arrival <= b.departure) ||
     (departure >= b.arrival && departure <= b.departure)));

  if (overlap) return showPopupMessage("Room already booked for those dates.");

  bookings.push({ guest, room, arrival, departure, deposit, bill, checkedIn: false });
  localStorage.setItem('bookings', JSON.stringify(bookings));
  closeBookingForm();
  renderBookings();
}

function findRoom() {
  const arrival = document.getElementById('arrivalDate').value;
  const departure = document.getElementById('departureDate').value;
  for (let room = 101; room <= 106; room++) {
    const booked = bookings.some(b => b.room == room &&
      ((arrival >= b.arrival && arrival <= b.departure) ||
      (departure >= b.arrival && departure <= b.departure)));
    if (!booked) {
      document.getElementById('roomNumber').value = room;
      showPopupMessage(`Assigned available Room ${room}`);
      return;
    }
  }
  showPopupMessage("No available rooms.");
}

function attemptCheckin(room) {
  if (confirm("Is the room clean?")) {
    const booking = bookings.find(b => b.room == room && b.arrival == selectedDate);
    if (booking) {
      booking.checkedIn = true;
      localStorage.setItem('bookings', JSON.stringify(bookings));
      renderBookings();
    }
  } else {
    showPopupMessage("Check-in not allowed. Room not clean.");
  }
}

function showAction(room) {
  const booking = bookings.find(b => b.room == room && b.arrival == selectedDate);
  if (!booking) return;
  const popup = document.getElementById('popupContent');
  popup.innerHTML = `
    <h3>Room ${room} - ${booking.guest}</h3>
    <p>Total Bill: £${booking.bill}</p>
    <button onclick="showBreakdown(${room})">Breakdown</button>
  `;
  document.getElementById('popupModal').style.display = 'flex';
}

function showBreakdown(room) {
  const booking = bookings.find(b => b.room == room && b.arrival == selectedDate);
  document.getElementById('popupContent').innerHTML = `
    <h3>Bill Breakdown - Room ${room}</h3>
    <p>Base Room: £75</p>
    ${booking.deposit ? `<p>Tab Deposit: £${booking.deposit}</p>` : ''}
    <p><strong>Total: £${booking.bill}</strong></p>
  `;
}

function showPopup(type) {
  let content = '<h3>' + type.charAt(0).toUpperCase() + type.slice(1) + ' Bookings</h3>';
  const now = new Date().toISOString().split('T')[0];
  bookings.filter(b =>
    type === 'history' ? b.departure < now :
    type === 'upcoming' ? b.arrival > now : false
  ).forEach(b => {
    content += `<p>${b.guest} - Room ${b.room} (${b.arrival} to ${b.departure})</p>`;
  });
  document.getElementById('popupContent').innerHTML = content;
  document.getElementById('popupModal').style.display = 'flex';
}

function showPopupMessage(msg) {
  document.getElementById('popupContent').innerHTML = `<p>${msg}</p>`;
  document.getElementById('popupModal').style.display = 'flex';
}

init();
</script>
</body>
</html>
